# Rate Limit 수정 테스트 가이드

## 테스트 준비

1. 개발 서버 시작
```bash
npm run dev
```

2. 브라우저에서 `http://localhost:3000/campaign/new` 접속

## 테스트 시나리오

### 시나리오 1: 정상적인 메시지 생성

**목적**: Rate limit이 없을 때 정상 작동 확인

1. 캠페인 정보 입력:
   - 캠페인명: "테스트 캠페인"
   - 목적: "신규 고객 유치"
   - 타겟: "20-30대"
   - 톤앤매너: "친근한"
   - 주요 메시지: "신규 가입 이벤트"

2. "메시지 생성" 버튼 클릭

3. **예상 결과**:
   - ✅ 로딩 스피너 표시
   - ✅ 5-10초 후 메시지 5개 생성
   - ✅ 성공 토스트 메시지 표시

### 시나리오 2: Rate Limit 발생

**목적**: Rate limit 처리 확인

1. "다시 생성" 버튼을 **빠르게 여러 번** 클릭 (5-10회)

2. **예상 결과**:
   - ✅ "요청 한도를 초과했습니다" 에러 메시지 표시
   - ✅ 버튼이 비활성화됨
   - ✅ 버튼 텍스트가 "메시지 생성 (XX초 후 가능)"으로 변경
   - ✅ 빨간색 경고 메시지와 progress bar 표시
   - ✅ 카운트다운이 1초마다 감소

### 시나리오 3: 카운트다운 확인

**목적**: 실시간 카운트다운 작동 확인

1. Rate limit 상태에서 대기

2. **예상 결과**:
   - ✅ 매초마다 남은 시간이 감소
   - ✅ Progress bar가 점진적으로 채워짐
   - ✅ 버튼 텍스트의 초 단위가 업데이트됨

### 시나리오 4: 페이지 새로고침

**목적**: localStorage 지속성 확인

1. Rate limit 상태에서 페이지 새로고침 (F5 또는 Cmd+R)

2. **예상 결과**:
   - ✅ 페이지 로드 후에도 rate limit 상태 유지
   - ✅ 카운트다운이 계속됨
   - ✅ 버튼이 여전히 비활성화 상태

### 시나리오 5: Rate Limit 만료

**목적**: 자동 복구 확인

1. Rate limit 카운트다운이 0초가 될 때까지 대기

2. **예상 결과**:
   - ✅ "이제 다시 메시지를 생성할 수 있습니다" 토스트 메시지 표시
   - ✅ 버튼이 자동으로 활성화됨
   - ✅ 버튼 텍스트가 "메시지 생성"으로 복구
   - ✅ 에러 메시지와 progress bar 사라짐

3. "메시지 생성" 버튼 클릭

4. **예상 결과**:
   - ✅ 정상적으로 메시지 생성됨

### 시나리오 6: 성과 예측 Rate Limit

**목적**: 성과 예측 API도 동일하게 작동하는지 확인

1. 메시지를 생성하고 하나 선택

2. 성과 예측이 로드되는 것을 확인

3. 다른 메시지를 **빠르게 여러 번** 클릭하여 성과 예측 API 호출

4. **예상 결과**:
   - ✅ Rate limit 발생 시 에러 메시지 표시
   - ✅ 카운트다운과 progress bar 표시
   - ✅ 시간이 지나면 자동으로 복구

## 브라우저 개발자 도구 확인

### localStorage 확인

1. 개발자 도구 열기 (F12 또는 Cmd+Option+I)
2. Application/Storage 탭 → Local Storage 선택
3. Rate limit 발생 시 확인할 항목:
   - `ai_generate_rate_limit`: 메시지 생성 rate limit 시간 (타임스탬프)
   - `ai_predict_rate_limit`: 성과 예측 rate limit 시간 (타임스탬프)

### Console 확인

1. Console 탭에서 에러 메시지 확인
2. Rate limit 발생 시:
   ```
   Prediction error: 요청 한도를 초과했습니다. 60초 후 재시도 가능합니다.
   ```

### Network 확인

1. Network 탭에서 API 요청 확인
2. Rate limit 발생 시:
   - Status: `429 Too Many Requests`
   - Response: `{ "error": "요청 한도를 초과했습니다...", "retryAfter": 60 }`

## 엣지 케이스 테스트

### 1. 여러 탭에서 동시 사용

1. 같은 페이지를 새 탭에서 열기
2. 한 탭에서 rate limit 발생시키기
3. 다른 탭에서 버튼 클릭 시도

**예상**: 각 탭이 독립적으로 localStorage를 읽지만, 같은 키를 공유하므로 rate limit이 공유됨

### 2. 시스템 시간 변경

**주의**: 이 테스트는 실제 환경에서는 권장하지 않음

1. Rate limit 발생
2. 시스템 시간을 1분 앞으로 변경
3. 페이지 새로고침

**예상**: Rate limit이 즉시 해제됨 (타임스탬프 기반이므로)

### 3. localStorage 수동 삭제

1. Rate limit 발생
2. 개발자 도구에서 localStorage의 rate limit 키 삭제
3. 페이지 새로고침 없이 버튼 클릭

**예상**: 카운트다운이 계속 표시되지만, 다음 interval 체크에서 localStorage가 없음을 감지하고 해제

## 문제 해결

### 문제: Rate limit이 해제되지 않음

**해결**:
1. 개발자 도구 → Application → Local Storage
2. `ai_generate_rate_limit` 및 `ai_predict_rate_limit` 키 삭제
3. 페이지 새로고침

### 문제: 카운트다운이 작동하지 않음

**확인**:
1. Console에 에러가 있는지 확인
2. localStorage에 rate limit 키가 있는지 확인
3. 타임스탬프 값이 유효한지 확인 (미래 시간이어야 함)

### 문제: 버튼이 활성화되지 않음

**해결**:
1. 페이지 새로고침
2. localStorage 수동 삭제
3. 브라우저 캐시 삭제

## 성공 기준

모든 시나리오에서:
- ✅ 에러 없이 작동
- ✅ UI가 예상대로 업데이트됨
- ✅ 사용자에게 명확한 피드백 제공
- ✅ 페이지 새로고침 후에도 상태 유지
- ✅ Rate limit 만료 후 자동 복구

## 추가 확인 사항

1. **성능**: 1초마다 실행되는 interval이 성능에 영향을 주지 않는지 확인
2. **메모리 누수**: 컴포넌트 언마운트 시 interval이 제대로 정리되는지 확인
3. **접근성**: 스크린 리더 사용자도 rate limit 상태를 이해할 수 있는지 확인
